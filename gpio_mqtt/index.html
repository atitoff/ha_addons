<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- The page supports both dark and light color schemes,
         and the page author prefers / default is light. -->
    <meta name="color-scheme" content="light dark">

    <!-- Replace the Bootstrap CSS with the
         Bootstrap-Dark Variant CSS -->
    <link href="web/bootstrap-dark.min.css" rel="stylesheet">

    <title>{{ .Port}}</title>

    <!-- Optional Meta Theme Color is also supported on Safari and Chrome -->
    <meta name="theme-color" content="#111111" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#eeeeee" media="(prefers-color-scheme: dark)">
</head>
<body style="margin: 1em">
<button type="button" class="btn btn-primary">Поиск нового светильника DALI</button>

<!-- Optional Bootstrap JavaScript -->
<script src="web/bootstrap.bundle.min.js"></script>
<script src="web/mqttws31.min.js"></script>
<script>
    let Host = {{ .Host}}
    let Port = {{ .Port}}
    let Login = {{ .Login}}
    let Password = {{ .Password}}
    client = new Paho.MQTT.Client(
        Host,
        parseInt(Port),
        (Math.random() + 1).toString(36).substring(2)
    );

    // set callback handlers
    client.onConnectionLost = onConnectionLost
    client.onMessageArrived = onMessageArrived

    // connect the client
    client.connect({
        onSuccess: onConnect,
        userName: Login,
        password: Password,
        useSSL: true,
    });

    // called when the client connects
    function onConnect() {
        // Once a connection has been made, make a subscription and send a message.
        console.log("onConnect");
        client.subscribe("World");
    }

    // called when the client loses its connection
    function onConnectionLost(responseObject) {
        if (responseObject.errorCode !== 0) {
            console.log("onConnectionLost:"+responseObject.errorMessage);
        }
    }

    // called when a message arrives
    function onMessageArrived(message) {
        console.log("onMessageArrived:"+ message.payloadString);
        console.log(`Topic:     ` + message.destinationName);
    }

</script>
</body>
</html>